@model FitFlow.Models.Views.MenuModel
<div class="collapse navbar-collapse affix" id="main-menu">
    @foreach (var item in Model.MenuList.Select((v, i) => new { v, i })) {
        @AsMenuItem(item.v, item.i, Model.MenuList)
    }
</div>
@helper AsActive(string url)
{
    var active = (Request.Path == url) ? "active" : string.Empty;
    @active
}

@helper AsMenuItem(FitFlow.Models.FitFlow.Menus menu, int idx, List<FitFlow.Models.FitFlow.Menus> menuList)
{
    if (idx == 0 || menu.Category != menuList[idx - 1].Category) {
        @Html.Raw("<div class=\"list-group\" id=\"main-menu\">")
        if (!string.IsNullOrEmpty(menu.Category)) {
            <a class="list-group-item list-group-item-heading">@menu.Category</a>
        }
    }
    <a href="@menu.URL" class="list-group-item @AsActive(menu.URL)">
        <span class="@menu.Icon"></span>
        @menu.Name
    </a>
    if (idx == menuList.Count -1 ||
            (idx + 1) < menuList.Count && menu.Category != menuList[idx + 1].Category) {
        @Html.Raw("</div>")
    }
}
